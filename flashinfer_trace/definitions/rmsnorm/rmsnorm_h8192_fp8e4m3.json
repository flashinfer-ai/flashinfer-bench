{
  "name": "rmsnorm_h8192_fp8e4m3",
  "op_type": "rmsnorm",
  "description": "RMS Layer Normalization with hidden_size=8192 using FP8 E4M3 inputs. For FP8-quantized LLaMA-70B models.",
  "tags": [
    "status:verified",
    "model:llama-3.1-70b-fp8",
    "dtype:fp8"
  ],
  "axes": {
    "batch_size": {
      "type": "var",
      "description": "Batch size (typically batch * seq_len)"
    },
    "hidden_size": {
      "type": "const",
      "value": 8192
    }
  },
  "inputs": {
    "hidden_states": {
      "shape": ["batch_size", "hidden_size"],
      "dtype": "float8_e4m3fn",
      "description": "Input hidden states in FP8"
    },
    "weight": {
      "shape": ["hidden_size"],
      "dtype": "float8_e4m3fn",
      "description": "Normalization weights in FP8"
    }
  },
  "outputs": {
    "output": {
      "shape": ["batch_size", "hidden_size"],
      "dtype": "float8_e4m3fn",
      "description": "Normalized output in FP8"
    }
  },
  "reference": "import torch\n\n@torch.no_grad()\ndef run(hidden_states, weight):\n    batch_size, hidden_size = hidden_states.shape\n    \n    assert hidden_size == 8192\n    \n    x = hidden_states.to(torch.float32)\n    w = weight.to(torch.float32)\n    \n    variance = x.pow(2).mean(-1, keepdim=True)\n    x = x * torch.rsqrt(variance + 1e-6)\n    output = w * x\n    \n    return output.to(hidden_states.dtype)"
}
